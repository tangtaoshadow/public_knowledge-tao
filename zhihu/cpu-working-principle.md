# CPU 是如何认识和执行代码的

**Author：**[杭州电子科技大学](http://www.hdu.edu.cn/)  `2016级 唐涛` [16011324@hdu.edu.cn](mailto:16011324@hdu.edu.cn)

**CreateTime：**`2019-10-6 20:18:05`

**UpdateTime：**`2019-10-6 20:36:39`

**Copyright:**  唐涛 2019 ©  [HOME](https://www.promiselee.cn/tao) 

**Email：**[tangtao2099@outlook.com](mailto:tangtao2099@outlook.com)

**Link：**  [知乎](https://www.zhihu.com/people/tang-tao-24-36/activities)  [GitHub](https://github.com/tangtaoshadow)



---

# CPU的介绍

**CPU** 也称为微处理器，是计算机的心脏和/或大脑。深入研究计算机的核心，可以帮助我们有效地编写计算机程序。

**CPU** 是计算机的心脏和大脑，它执行提供给他们的指令。它的主要工作是执行算术和逻辑运算并将指令编排在一起。



## 我们先来看一下CPU的主要组件是什么以及它们的作用：



## 处理器两个主要组件

- **控制单元 CU**
- **算术和逻辑单元 ALU**



#### 1.控制单元 CU

控制单元**CU**是**CPU**的一部分，它可以帮助**CPU**协调指令的执行，它告诉**CPU**该怎么办。并根据说明，它有助于激活将CPU连接到计算机的其他各个部分（包括ALU）。控制单元是**CPU**接收处理指令的第一个组件。

控制单元也有两种类型：

- 硬连线  **控制单元**。
- 微型可编程（微型）  **控制单元**。

**硬连线**  控制单元是指硬件，需要对硬件进行更改以添加修改以使其正常工作，而可以对微可编程控制单元进行编程以更改其行为。硬接线**CU**处理指令的速度更快，而微编程的灵活性更高。



#### 2.算术和逻辑单元 ALU

顾名思义，算术和逻辑单元**ALU**进行所有算术和逻辑计算。**ALU**执行加减运算。**ALU**由执行这些操作的逻辑电路或逻辑门组成。

大多数逻辑门接受两个输入并产生一个输出，下面是一个半加法器电路的示例，该电路采用两个输入并输出结果。这里A和B是输入，S是输出，C是进位。

![img](http://cdn.promiselee.cn/share_static/files/github/github-cpu-2019-10-6-200417.png)





# 存储—寄存器和内存

CPU的主要工作是执行提供给它的指令，而要在大多数时间处理这些指令，它需要数据。一些数据是中间数据，其中一些是输入，其他是输出。这些数据和说明一起存储在以下存储器中：

#### 寄存器

寄存器是一小组可以存储数据的地方。寄存器是**锁存器**的组合 。 

**锁存器** 也称为 **触发器，** 是存储1位信息的**逻辑门的**组合  。

锁存器有两根输入线，写和输入线，以及一根输出线。我们可以启用写入线来更改存储的数据。禁用写线时，输出始终保持不变。



![img](http://cdn.promiselee.cn/share_static/files/github/cpu-2019-10-6-200733.gif)



CPU具有用于存储输出数据的寄存器，由于它是中间数据，因此发送到主存储器（RAM）会很慢。该数据被发送到通过**BUS**连接的其他寄存器 。寄存器可以存储指令，输出数据，存储地址或任何类型的数据。





# 内存（RAM）

**RAM**是寄存器的集合，这些寄存器以优化的方式排列并压缩在一起，以便可以存储更多数据。**RAM**（随机存取存储器）易失，当我们关闭电源时，数据会丢失。由于RAM是用于读取/写入数据的寄存器的集合，因此**RAM**接受8位地址的输入，输入要存储的实际数据的数据，最后读取和写入使能器，其对锁存器的作用相同。





# 什么是指令

**指令**是计算机可执行的粒度计算，CPU可以处理各种指令。

包括：

- 算术，例如  **加法**  和  **减法**
- 逻辑指令，例如  **和**，  **或**，而  **不是**
- 数据指令，例如  **移动**，  **输入**，  **输出**，  **加载**和  **存储**
- 控制流指令，例如  **goto**，  **如果... goto**，则  **调用**并  **返回**
- 通知程序已经结束CPU  **暂停**

使用汇编语言将指令提供给计算机，或者由编译器生成指令，或者以某些高级语言解释指令。

这些指令被硬件连线到CPU内部，ALU包含算术和逻辑，而控制流由CU管理。

在一个 **时钟周期内，**  计算机可以执行一条指令，但是现代计算机可以执行多条指令。

计算机可以执行的一组指令称为  **指令集**。





# CPU时钟

**时钟周期**

计算机的速度取决于其时钟周期。它是计算机每秒工作的  **时钟周期** 数。单时钟周期非常小，大约为`250 * 10 * -12`秒。时钟周期越高，处理器速度就越快。

一个CPU时钟循环以**GHz**（测量**吉赫兹**）。**1GHz**等于**10⁹Hz**（**赫兹**）。赫兹表示一秒钟执行的次数。因此1 GHz意味着每秒**10⁹**个周期。

时钟周期越快，**CPU**  可执行的指令越多  。**`时钟周期= 1 / CPU时钟频率时间 = 时钟周期数/时钟频率`**

这意味着可以通过优化提供给CPU的指令来缩短CPU时间，从而提高时钟频率或减少时钟周期数。某些处理器可以增加时钟周期，但由于是物理变化，因此可能会过热甚至冒烟/起火。



# **总线**

CPU，寄存器，存储器和IO设备之间的所有数据都通过总线传输。

为了将数据加载到刚刚添加的存储器中，CPU将存储器地址放入地址总线，并将总和结果放入数据总线，并在控制总线中启用正确的信号。这样，数据将在总线的帮助下加载到内存中。



![cpu-bus](http://cdn.promiselee.cn/share_static/files/github/cpu-bus-20191006202012.png)







---

# 接下来来解释指令如何执行

指令按顺序存储在 **RAM** 中。对于一个假设的CPU，指令由  **OP**  代码（操作代码）和  **存储器或寄存器地址组成**。

在控制单元**指令寄存器（IR）中** 有两个寄存器  ，用于加载指令的OP代码；在 **指令地址寄存器中** ，用于加载当前正在执行的指令的地址。CPU内还有其他寄存器，用于存储存储在指令后4位地址中的值。



## **以一组将两个数字相加的指令为例，以下是说明：**

**步骤1 — LOAD_A 8：**

最初将指令保存在**RAM**中，例如`<1100 1000>`。前4位是操作码，它确定了指令。该指令被**提取**到控制单元的**IR** 中。指令被**解码**为d_load_A，这意味着它需要将数据加载到地址`1000`中，该地址是指令A的最后4位。

**步骤2 — LOAD_B 2**

与上面类似，这会将内存地址2（`0010`）中的数据加载到CPU寄存器B。

**第3**  **步-添加BA**

现在，下一条指令是将这两个数字相加。此处，**CU**告诉**ALU**执行加法运算并将结果保存回寄存器A。

**步骤4 — STORE_A 23**

这是一组非常简单的说明，有助于将两个数字相加。

**现在我们已经成功地添加了两个数字！٩(๑❛ᴗ❛๑)۶٩(๑❛ᴗ❛๑)۶**









---

## **下面介绍一些计算机术语**





# 快取

CPU还具有一种将指令预取到其缓存的机制。

众所周知，处理器可以在一秒钟内完成数百万条指令。这意味着从**RAM**提取的指令要比执行指令花费更多的时间。因此，CPU高速缓存会预取一些指令以及数据，以便快速执行。

如果高速缓存和操作存储器中的数据不同，则将数据标记为**脏位**。





# **指令流水线**

现代CPU使用**指令流水线**来并行执行指令，把 `提取，解码，执行` 当一条指令执行，当处于解码阶段时，CPU可以在提取阶段处理另一条指令。

![cpu-pipelining](http://cdn.promiselee.cn/share_static/files/github/cpu-pipelining-20191006202445.png)

**但是**当一条指令依赖于另一条指令时，这将产生一个问题。因此，处理器以不相同的顺序执行不相关的指令。





# 多核计算机

它基本上是不同的CPU，但是有一些共享资源，例如缓存。





# 性能

CPU的性能取决于其执行时间，性能= 1 /执行时间

假设一个程序执行需要20毫秒。CPU的性能为1/20 = 0.05ms，相对性能=执行时间1 /执行时间2

CPU性能要考虑的因素是`指令执行时间`和`CPU时钟速度`。因此，要提高程序的性能，我们要么需要提高时钟速度，要么需要减少程序中的指令数量。处理器速度有限，具有多核功能的现代计算机每秒可支持数百万条指令。但是，如果我们编写的程序有很多指令，则会降低整体性能。

**大O表示法** 使用给定的输入确定如何影响性能。

CPU中进行了许多优化，以使其更快，性能尽可能高。在编写任何程序时，我们需要考虑减少提供给CPU的指令数量将如何提高计算机程序的性能。



## [原文链接](https://github.com/taoshadow/public_knowledge-tao/blob/master/zhihu/cpu-working-principle.md)